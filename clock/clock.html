
<canvas id="canvas-0" width="1440" height="256"></canvas>

<script src="../js/window.audiocontext.js"></script>
<script src="../js/navigator.getusermedia.js"></script>
<script src="../js/object.setprototypeof.js"></script>

<script src="../modules/object.assign/object.assign.js"></script>
<script src="../modules/fn/js/fn.js"></script>

<script src="../modules/fn/js/events.js"></script>
<script src="../modules/collection/js/observe.js"></script>
<script src="../modules/collection/js/collection.js"></script>

<script src="../modules/audio-object/js/audio-object.js"></script>
<script src="../modules/audio-object/js/ao-oscillator.js"></script>
<script src="../modules/audio-object/js/ao-sampler.js"></script>
<script src="../modules/audio-object/js/ao-sampler-presets-gretsch-kit.js"></script>

<script src="js/clock.js"></script>
<script src="js/head.js"></script>

<script src="test/data-accel.js"></script>
<script src="test/canvas.js"></script>

<style>
	html,
	body {
		margin: 0;
		padding: 0;
		-webkit-overflow-scrolling: auto;
	}

	canvas {
		display: block;
		width: 1440px;
	}
</style>

<script>
	var Clock = window.Clock;
	var audio = new window.AudioContext();

	var oscillator = new AudioObject.Oscillator(audio, {
		frequency: 200,
		waveform: 'sine',
		gain: 0.0625
	});
	var output = AudioObject.getOutput(oscillator);
	output.connect(audio.destination);

	var sampler = new AudioObject.Sampler(audio, {}, {}, AudioObject.presets);
	var output = AudioObject.getOutput(sampler);
	output.connect(audio.destination);

	var timer = new CueTimer(Clock.frameDuration, Clock.lookahead, function() {
		return audio.currentTime;
	});

	var clock = new Clock(timer, audio, []);

	var n = 0;

	timer.requestCue(function cue(time) {
		// Make the test run for 3 seconds only
		if (audio.currentTime > 6) {
			head.stop();
			return;
		}

		graph.drawCue(audio.currentTime, time);
		timer.requestCue(cue);
	});

	document.addEventListener('visibilitychange', function(e) {
		graph.drawBar(audio.currentTime, '#cc6622');
	});

	//var sequence = [
	//	[0, 'note', 50, 1, 1]
	//];

	var head = Head(timer, clock, sequence,
	Fn.id,
//	function transform(event) {
//		if (event[1] === "note") {
//		  var e = event.slice();
//		  e[2] = event[2] + 16;
//		  return e;
//		}
//		return event;
//	},
	function trigger(event) {
		//oscillator.schedule(event);
		sampler.schedule(event);
		graph.drawEvent(audio.currentTime, event);
	},
	function find(name) {
		return sequence;
	});

	setTimeout(function() {
		graph.drawBar(audio.currentTime);
		clock.start();
		console.log('CLOCK', clock.now().toFixed(4));

		setTimeout(function() {
			graph.drawBar(audio.currentTime);
			console.log('CLOCK', clock.now().toFixed(4));
			head.start();
		}, 400);
	}, 400);

</script>
