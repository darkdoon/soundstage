
<canvas id="canvas-0" width="7200" height="256"></canvas>

<script src="../js/window.audiocontext.js"></script>
<script src="../js/navigator.getusermedia.js"></script>
<script src="../js/object.setprototypeof.js"></script>

<script src="../modules/object.assign/object.assign.js"></script>
<script src="../modules/fn/js/fn.js"></script>
<script src="../modules/fn/js/events.js"></script>
<script src="../modules/collection/js/observe.js"></script>
<script src="../modules/collection/js/collection.js"></script>

<script title="config">
	Fn.debug = true;
</script>

<script src="../modules/audio-object/js/audio-object.js"></script>
<script src="../modules/audio-object/js/ao-oscillator.js"></script>
<script src="../modules/audio-object/js/ao-sampler.js"></script>
<script src="../modules/audio-object/js/ao-sampler-presets-gretsch-kit.js"></script>
<script src="../modules/audio-object/js/ao-sampler-presets-mis-piano.js"></script>
<script src="../modules/audio-object/js/ao-sampler-presets-fender-rhodes-mark-ii.js"></script>

<script src="js/cuetimer.js"></script>
<script src="js/head.js"></script>
<script src="js/clock.js"></script>

<script src="test/data-bebop-major-2-octaves.js"></script>
<script src="test/canvas.js"></script>

<style>
	html,
	body {
		margin: 0;
		padding: 0;
		-webkit-overflow-scrolling: auto;
	}

	canvas {
		display: block;
		width: 7200px;
	}
</style>

<script>
	var Clock = window.Clock;
	var audio = new window.AudioContext();

	var oscillator = new AudioObject.Oscillator(audio, {
		frequency: 200,
		waveform: 'sine',
		gain: 0.0625
	});

	var output = AudioObject.getOutput(oscillator);
	output.connect(audio.destination);

	var sampler = new AudioObject.Sampler(audio, {}, {}, AudioObject.presets);
	var output = AudioObject.getOutput(sampler);
	output.connect(audio.destination);
	sampler['sample-map'] = "MIS Piano";

	var clock = new Clock(audio, [], findSequence);

	clock.requestCue(function cue(time) {
		// Make the test run for 30 seconds only
		if (audio.currentTime > 30) {
			clock.stop();
			return;
		}

		graph.drawCue(audio.currentTime, time);
		clock.requestCue(cue);
	});

	document.addEventListener('visibilitychange', function(e) {
		graph.drawBar(audio.currentTime, '#cc6622');
	});

	//setTimeout(function() {
		clock.start(Math.ceil(audio.currentTime));

		graph.drawBar(audio.currentTime);
		console.log('CLOCK', clock.now().toFixed(4));

		clock.play(
			clock.now(),
			sequence,
			function trigger(event) {
				//oscillator.schedule(event);
				sampler.schedule(event);
				graph.drawEvent(audio.currentTime, event);
			}
		);
	//}, 400);

</script>
